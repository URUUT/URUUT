:css
  .save-new-perk, .update-perk {
    background: #3F403B;
    border: none;
    border-radius: 0;
    box-shadow: none;
    color: white;
    font: bold 16px/16px "Proxima Nova", arial, sans-serif;
    letter-spacing: 2px;
    position: relative;
    text-shadow: none;
    text-transform: uppercase;
    text-decoration: none;
  }
  .save-new-perk{
    top: 36px;
    padding: 14px 90px;
  }
  .update-perk{
    bottom: 0;
    padding: 14px 88px;
    margin-left: 23%;
  }
  .save-new-perk:hover, .update-perk:hover {
    color: #FFF;
    text-decoration: none;
  }
  #project-submit {
    margin-top: 20px;
    padding: 15px 58px;
  }

.step-container{"data-id" => "perks"}
  = form_for(@project, :html => {:class => "span8 well", :multipart => true}) do |f|

    %h4.title
      SEEDER PERKS
      %span.italic (Rewards for your donors)

    .perk-view
      %h5.green-font{:style => "margin-bottom:10px;"} PERKS ON URUUT
      %p
        Every dollar funded by donors on Uruut is rewarded dollar with Uruut Reward Points. Using customized Seeder Perks for your donors is not required.
      %p
        If you don't use custom Seeder Perks, your project wil have the default donation levels of $10, $25, $50, $100 and $250. Your donors will receive 1 Uruut Reward Point for each dollar they contribute. If you do choose to offer custom perks, as the project owner, will be required to create your own donation levels for each perk offered.

      %h6{:style => "color:#70bf4c"} USE CUSTOM SEEDER PERKS?
      .span2{style: "margin-left: 0"}
        = f.select :perk_permission, options_for_select({ "Yes" => "yes", "No" => "no" }, session[:status_permission_perk].nil? ? "no" : session[:status_permission_perk]), {}, {:onchange => "changePerkPermission()"}

    .clearfix


    - if @project.errors.any?
      #errorExplanation
        %h2 #{pluralize(@project.errors.count, "error")}
        %ul
          - @project.errors.full_messages.each do |msg|
            %li #{msg}
    %div.perk-true{style: "#{@perks.blank? ? 'display:none' : '' }"}
      %fieldset{:style => "position:relative"}
        .perk-container
          .perk
            .row
              .span8
                .row
                  .span4
                    = label_tag "perk-amount", class: "green-font" do
                      SEED AMOUNT*
                      %span.italic{style: "color: #000; font-size: 10px;"} (full $ amounts only)
                    = text_field_tag "perk-amount", '', class: "span4"
                  .span4
                    = label_tag "perk-name", class: "green-font" do
                      PERK TITLE*
                      %span.italic.title-count{style: "color: #000; font-size: 10px;"}
                    = text_field_tag "perk-name", '', class: "span4"

            %div
              = label_tag "perk-description", class: "green-font" do
                Description*
                %span.italic.desc-count{style: "color: #000; font-size: 10px;"}
              = text_area_tag "perk-description", nil, style: "height:120px;width:605px;"

            .row.perk-view
              .span2
                %div{style: "font-size: 10px;"}
                  = label_tag "limit_perk", "LIMIT # AVAILABLE", class: "green-font"
                = select_tag "limit_perk", options_for_select({ "Yes" => "yes", "No" => "no" }, "yes")
              .span5
                = label_tag "perk_available", "HOW MANY OF THIS PERK ARE AVAILABLE", class: "green-font"
                = text_field_tag "perk_available", '', class: "span6"

            %input{:type => 'hidden', :value => "", :id => "perk-id"}

      .row
        .span4
          %a.save-new-perk{:href => "#"} SAVE PERK
        .span4{style: "margin-left: 0"}
          = f.submit "Save And Continue", :class => "btn project-save-continue", :id => "project-submit", :style => "position: relative;"

      %a.update-perk{:href => "#"} UPDATE PERK

    %div.perk-false{style: "#{@perks.blank? ? '' : 'display:none' }"}
      = link_to "CONTINUE TO STEP 4", "/projects/#{@project.id}/edit#sponsorship", class: "btn", id: "project-submit", style: "position: relative;display:block;margin:0 auto;width:33%"

  .span4{:style => "margin-top:155px;"}
    %h4.title{:style => "margin-bottom:5px;"} SET UP GUIDE
    .well.info
      - unless @perks.blank?
        %h5{:style => "color:#70bf4c;margin-bottom:10px;"} CURRENT PERKS
        .list-perk
          - @perks.each do |p|
            %div.created-perk
              %h6= get_currency(p.amount)
              %h6= p.name
              %p{:style => "width:268px;word-wrap: break-word;"}= p.description
              %input{:type => 'hidden', :value => "#{p.id}", :id => "perk-#{p.id}"}
              %a{:class => "perk-edit", :style => "color:#70bf4c;"} edit
              |
              %a{:class => "perk-delete", :style => "color:#70bf4c;"} delete

      %h5{:style => "color:#70bf4c;margin-bottom:10px;"} SEEDER PERKS
      %p Funding on URUUT is made in exchange for payment in kind: goods, services, special benefits or other perks. Offer something valuable for the funds. No T-shirts and shout-outs for $100.

      %p Perks could include a house account for your investors, discounted goods or services, special lessons or workshops, or a private party just for seeders. Be creative!
      %p The most common amounts invested are between $25-$100. We suggest you offer some good value perks at a low cost for casual investors who might not know your organization well, and a handful of high end rewards that are likely to appeal to your inner circle or die-hard fans.
      %p If youâ€™re having a hard time thinking about some great perks, check out our Project Guide or just let us know and we can help you.


:javascript
  function updateCountTitle() {
    var remaining = 30 - jQuery('#perk-name').val().length;
    jQuery('.title-count').text('(' + remaining + ' characters remaining.)');
  };

  function updateDescTitle() {
    var remaining = 140 - jQuery('#perk-description').val().length;
    jQuery('.desc-count').text('(' + remaining + ' characters remaining.)');
  };

  updateCountTitle();
  updateDescTitle();
  $('#perk-name').change(updateCountTitle);
  $('#perk-name').keyup(updateCountTitle);
  $('#perk-description').change(updateDescTitle);
  $('#perk-description').keyup(updateDescTitle);

  var changePerkPermission = function(){
    if ( $("#project_perk_permission").val() == "no" ){
      $(".perk-true").hide();
      $(".perk-false").show();
      $.ajax({
        type: 'GET',
        url : "/projects/set_perk_permission?status="+$("#project_perk_permission").val()
      });
    }
    else{
      $(".perk-false").hide();
      $(".perk-true").show();
      $.ajax({
        type: 'GET',
        url : "/projects/set_perk_permission?status="+$("#project_perk_permission").val()
      });
    }
  };

  $('.save-new-perk').on('click', function(e) {
    e.preventDefault();
    console.log(document.location.hostname);
    var name = $('#perk-name').val();
    var amount = $('#perk-amount').val();
    var description = $('#perk-description').val();
    var project = #{@project.id};
    var data = {
      name: name,
      amount: amount,
      description: description,
      project: project,
      perks_available: $("#perk_available").val(),
      limit: $("#limit_perk").val()
    };
    $.ajax({
      type: 'POST',
      url: 'http://' + document.location.hostname + ":" + document.location.port + '/projects/add_perk',
      data: data
    }).done(function(data) {
      console.log(data);
      window.location.reload(true);
    });
  });


  $('.project-save-continue').on('click', function(e) {
    e.preventDefault();
    console.log(document.location.hostname);
    var name = $('#perk-name').val();
    var amount = $('#perk-amount').val();
    var description = $('#perk-description').val();
    var project = #{@project.id};
    var data = {
      name: name,
      amount: amount,
      description: description,
      project: project,
      perks_available: $("#perk_available").val(),
      limit: $("#limit_perk").val(),
      status: "continue"
    };
    $.ajax({
      type: 'POST',
      url: 'http://' + document.location.hostname + ":" + document.location.port + '/projects/add_perk',
      data: data
    }).done(function(data) {
      console.log(data);
      window.location = 'http://' + document.location.hostname + ":" + document.location.port + '/projects/'+ project +'/edit#sponsorship';
    });
  });

  $('.update-perk').on('click', function(e) {
    e.preventDefault();
    var name = $('#perk-name').val();
    var amount = $('#perk-amount').val();
    var description = $('#perk-description').val();
    var perk_id = $('#perk-id').val();
    var data = {
      name: name,
      amount: amount,
      description: description,
      id: perk_id
    };
    $.ajax({
      type: 'POST',
      url: 'http://' + document.location.hostname + ":" + document.location.port + '/projects/update_perk',
      data: data
    }).done(function(data) {
      console.log(data);
      window.location.reload(true);
    });
  })

  $('.perk-delete').on('click', function(e) {
    e.preventDefault();
    var perk_id = $(this).parent().find('input[type=hidden]').val();
    console.log(perk_id);
    var data = {id: perk_id};
    $.ajax({
      type: 'POST',
      url: 'http://' + document.location.hostname + ":" + document.location.port + '/projects/delete_perk',
      data: data
    }).done(function(data) {
      console.log(data);
      window.location.reload(true);
    });
  })

  $('.created-perk .perk-edit').on('click', function() {
    $.ajax({
      type: 'POST',
      url: '#{get_perk_projects_url}',
      data: {id: $(this).parent().find('input[type=hidden]').val()}
    }).done(function(data) {
      $('#perk-name').val(data.name);
      $('#perk-amount').val(data.amount);
      $('#perk-description').val(data.description);
      $('#perk-id').val(data.id)
      $('.save-new-perk, #project-submit, .perk-view').hide();
      $('.update-perk').show();
    });
  });
