.step-container{"data-id" => "sponsor-info"}
  = form_for(project, :html => {:class => "sponsor-info sponsor-info-form span8 well"}) do |f|

    - if project.errors.any?
      #errorExplanation
        %h2 #{pluralize(project.errors.count, "error")}
        %ul
          - project.errors.full_messages.each do |msg|
            %li #{msg}

    %h4.title
      YOUR RUUTS
      %span.italic (Basic Information)

    %div
      = f.label :organization, class: "label-green" do
        Organization/Business Name*
        %span.error-container
      = f.text_field :organization, :required => true, class: "span8"

    .clearfix
      %div.pull-left
        = f.label :organization_type, "Organization Type*", class: "label-green"
        .selectParent{style: "width: 290px;"}
          = f.select :organization_type, options_for_select(project_org_type, @project.organization_type), {:include_blank => 'Select Org Type'}, {:onchange => "updateOrganizedTypeInfo()", class: "styledSelect required"}
        %span.error-container

      %div.pull-left{:style => "margin-left:20px;"}
        = f.label :organization_class, "How Are You Organized?*", class: "label-green"
        .selectParent{style: "width: 290px;"}
          = f.select :organization_classification, options_for_select(project_org_class, @project.organization_classification), {:include_blank => 'Select Org Class'}, {:onchange => "updateOrganizedInfo()", class: "styledSelect required"}
        %span.error-container
    %div
      = f.label :address, class: "label-green" do
        STREET ADDRESS*
        %span.error-container
      = f.text_field :address, :required => true, class: "span8"

    %div.inline
      = f.label :city, "CITY*", class: "label-green"
      = f.text_field :city, :required => true, class: "span4"
      %span.error-container

    %div.inline{:style => "margin-left:25px;"}
      = f.label :state,"STATE*", class: "label-green"
      .selectParent{style: "width: 140px"}
        = f.select :state, options_for_select(us_states, @project.state), {:required => true}, {:onchange => "updateStateInfo()", class: "styledSelect"}
      %span.error-container

    %div.inline{:style => "margin-left:25px;"}
      = f.label :zip, "Zipcode*", class: "label-green"
      = f.text_field :zip, :required => true, class: "span2"
      %span.error-container

    %div
      = f.label :website, :class => "label-green" do
        WEBSITE ADDRESS*
        %span.italic (Format: www.mysite.com)
        %span.error-container
      = f.text_field :website, :required => true, class: "span8"

    %div
      = f.label :facebook_page, :class => "label-green" do
        Facebook Page*
        %span.italic (Format: facebook.com/yourpage)
        %span.error-container
      = f.text_field :facebook_page,  class: "required span8"

    %div
      = f.label :twitter_handle, class: "label-green" do
        Twitter Account*
        %span.error-container
      = f.text_field :twitter_handle,  class: "required span8"


    = hidden_field_tag "step", "first"

    %div
      %p.label-green{:style => "font: bold 12px/12px 'Proxima Nova', arial, sans-serif;text-transform: uppercase;"}
        Payment With Stripe
      %p{:style => "font:normal 13px/19px 'Proxima Nova';"} An account with Stripe, our payment provider, is required for processing credit card transactions and receiving funds. If you already have an account, you can sign in as a returning customer.
      = link_to "https://connect.stripe.com/oauth/authorize?scope=read_only&response_type=code&client_id=#{Settings.stripe.client_id}", :target => "_blank", :class => "stripe-connect" do
        = image_tag "stripe-connect.png"

      %hr{:style => "background: #e0e0e0; margin-left: -19px; margin-right: -19px;"}

      %div
        - if !session[:connected].blank?
          = f.submit "Save And Continue", :class => "btn wizard-btn", :id => "project-submit"
        - else
          %a.btn.wizard-btn{"data-toggle" => "modal", :href => "#connectStripeModal", :role => "button", style: "width: 266px;"}
            Stripe Not Connected

  .span4{:style => "margin-top:155px;"}
    %h4.title{:style => "margin-bottom:5px;"} SET UP GUIDE
    .well.info
      %h5{:style => "color:#70bf4c;margin-bottom:10px;"} Your Ruuts
      %p First, we are so thrilled to have you on URUUT!

      %p The process of building your project is simple and easy. We will walk you through each step and offer handy tips to make your project a success. For a more detailed guide on how to build and run a successful project, we will send you a complete Project Handbook once your project has been approved.

      %p The first steps are Your Ruuts - which is your basic information - go ahead and get started! Donâ€™t worry if you get stuck - you can come back anytime to edit your project right from your own profile dashboard page.
%section#connectStripeModal.modal.hide.fade
  .modal-header{style: "height: 17px;"}
    %button.close.closes{"aria-hidden" => "true", "data-dismiss" => "modal", :type => "button"}
      Close X
    %h3#myModalLabel.tittle{:style => "margin-bottom: 0;"} Oops
  .modal-body
    %p
      Connect with Stripe, please.
  .modal-footer
    %button.btn{"aria-hidden" => "true", "data-dismiss" => "modal", style: "float: none; margin: 0 auto;"} Ok


%section#connectStripeModal.modal.hide.fade
  .modal-header{style: "height: 17px;"}
    %button.close.closes{"aria-hidden" => "true", "data-dismiss" => "modal", :type => "button"}
      Close X
    %h3#myModalLabel.tittle{:style => "margin-bottom: 0;"} Oops
  .modal-body
    %p
      Connect with Stripe, please.
  .modal-footer
    %button.btn{"aria-hidden" => "true", "data-dismiss" => "modal", style: "float: none; margin: 0 auto;"} Ok

:javascript

  $(function(){
    jQuery.validator.addMethod("requiredUrl", function(val, elem) {
    return  /((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/.test(val);
    }, jQuery.validator.messages.url);

    $(".sponsor-info-form").validate({
      rules: {
        "project[zip]": {
          required: true,
          digits: true
        },
        "project[website]": {
          required: true,
          requiredUrl: true
        }
      },
      errorPlacement: function(error, element) {
        error.appendTo(element.parent().find(".error-container"));
      }
    });

    $('.step-container[data-id="sponsor-info"] form').on('submit', function(e){
      if ( connect.length > 0 ) {
      e.preventDefault();
      if (!$(this).valid()) return;
        $('.step-container[data-id="sponsor-info"] form input#project-submit').val("LOADING..");
        var data = $(this).serialize();
        var project = #{@project.id};
        $.ajax({
          type: 'POST',
          url: '#{project_path(@project.id)}',
          data: data
        }).done(function(data){
          $.ajax({
            type: 'GET',
            url: 'https://' + document.location.hostname + ":" + document.location.port + '/projects/update_td_mark?id='+project
          });
          $(".project-details-link").attr("href", "/projects/" + data +"/edit#project-details");
          $('.step-container[data-id="sponsor-info"] form input#project-submit').val("SAVE AND COUNTINUE");
          $(".wizard-data-location").text( $("#project_city").val() + ", "+ $("#project_state").val() );
          $(".wizard-data-all-location").text( $("#project_address").val() + " "+ $("#project_city").val() + " " + $("#project_state").val() + " " + $("#project_zip").val() );
          $(".wizard-data-organization").text( $("#project_organization").val() );
          localStorage.clear();

          window.location.href = '/projects/' + data + '/edit#project-details';
        })
      }else{
       alert("Connect with Stripe, please.");
       return false;
      }
    });
  })
