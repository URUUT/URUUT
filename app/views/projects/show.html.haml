#large_image
  .funding-info
    .container
      .span5
        %h4.title= @project.title
        %span.location #{@project.city}, #{@project.state}
        %hr
        %p.short-desc= @project.short_description
              
        - if current_user
          - if Donation.already_donated(@project.id, current_user.id).nil?
            = link_to "Fund Now", new_donation_path, :class => "btn"
          - else
            %h4.already-donated You've donated #{number_to_currency(Donation.already_donated(@project.id, current_user.id), :precision => 0)}
            #{link_to "Edit Your Donation", edit_donation_path(Donation.edit_donation(@project.id, current_user.id)), :class => "edit"}
        - elsif !current_user
          %a{:href => "#{new_donation_path}", :class => "fund btn"} Fund Now #{image_tag('arrow.png')}
      
      .span4.offset3
        /%h3= number_to_currency(amount_funded(@project.id))

        .progress-container
          = image_tag 'seed.png', :class => "seed"
          %div
            %span Seed Funds Pledged
            - if @donation.count == 0
              %p $0
            - else
              - totalDonated = 0
              - @donation.each do |d|
                - totalDonated += d.amount
              %p= number_to_currency(totalDonated, :precision => 0)  
            
        #progressbar

        %ul.project-details
          %li
            %span.small 
              Project 
              %br  
              Goal
            = number_to_currency(@project.goal, :precision => 0)

          %li
            %span.small 
              Days 
              %br
              Left 
            = time_left(@project.duration).to_i

.row-fluid.show-content
  .span8
    %h4.title Where We're Ruuted
    .map-container
      #map{:style => "width:100%;height:300px"}
      #map-details
        .project-location
          %h4= @project.title

    %ul.nav.nav-tabs
      %li.active
        %a{:href => "#planting_seeds"}
          %h4 
            Planting Seeds
            %span (About)
      %li
        %a{:href => "#growth"}
          %h4
            Growth
            %span (Updates)
      %li
        %a{:href => "#gallery"}
          %h4
            Gallery
    #content_container 
      #planting_seeds
        %p= @project.description.html_safe

      #growth
        %p This is growth

      #gallery
        %p This is gallery

      #cultivation
        .ending

        .details

    %hr
    .comments 
      %h4.comment Post a message
      %p
        Tell #{@project.title} you support their campaign! Got questions or need more information? Post them here and get an answer!

    .fb-comments{'data-href' => "http://127.0.0.1:8080", :style => "width:100%"}


  .span4.sidebar
    %h4.title Seeder Perks
    %ul.perks
      - @perks.each do |p|
        %li.perk
          %h3= p.name
          %p.description= p.description
          %ul
            %li
              %h6 SEED
              %p.amount $#{p.amount.to_i}
            %li.fund-button
              %a{:href => "#{new_donation_path}", :class => "fund btn"} Fund Now #{image_tag('arrow.png')}

    %h4.title
      Planter 
      %span (Project Organizer)
    .planter 
      = image_tag(get_gravatar(@user.email, 100), :style => "display:inline-block;margin-right:20px;")
      %h4{:style => "display:inline-block;color:#70bf4c;letter-spacing:2px;"}= @project.title

    %h4.title 
      Seeders (#{@donation.count})
      %span (Project Funders)
    -@donation.each do |donator|
      = image_tag(get_gravatar(donator.email, 25), :style => "float:left; margin:0 5px 5px 0;")

%script{:src => "http://cdn.leafletjs.com/leaflet-0.4/leaflet.js"}
%script{:src => "http://maps.stamen.com/js/tile.stamen.js?v1.2.1"}

:javascript
  $(function(){

    var activeTab = $('.nav-tabs li.active a').attr('href');
    var userLocation = 'http://where.yahooapis.com/geocode?q=#{@project.address},#{@project.city},#{@project.state}';

    $(activeTab).show();

    $.ajax({
      url: userLocation,
      success: function(data) {
        var latitude = $(data).find('latitude')[0].textContent;
        var longitude = $(data).find('longitude')[0].textContent;
        var map = L.map('map').setView([latitude,longitude], 11);

        L.tileLayer('http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png', {
          attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>'
        }).addTo(map);

        L.marker([latitude,longitude]).addTo(map).bindPopup('<h5>#{@project.title}</h5>').openPopup();
      }
    });


    $( "#progressbar" ).progressbar({
      value: #{percent_funded(@project.id)}
    });

    $('.nav-tabs li a').click(function(e){
      e.preventDefault();
      var show = $(this).attr('href');
      
      $('.nav-tabs li').removeClass('active');
      $('.nav-tabs li').each(function(){
        var content = $(this).find('a').attr('href');
        console.log(content);
        $(content).hide();
      });
      
      $(this).parent('li').addClass('active');
      $(show).show();
    });
  });
