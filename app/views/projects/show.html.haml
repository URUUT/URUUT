- if !@sponsorship_benefits.blank? && @project.sponsor_permission && @project_sponsors.include?(1)
  .platinum-level-container
    .container
      .row
        .span8
          = image_tag @project_sponsors[1].last.logo, :class => "sponsor-logo img-polaroid"
          .sponsor-info
            %h5
              = "#{@project_sponsors[1].last.sponsorship_level_name} Level Sponsor"
            %h3
              = @project_sponsors[1].last.name
            - unless @project_sponsors[1].last.site.nil?
              = link_to(strip_url(@project_sponsors[1].last.site), recognize_url(@project_sponsors[1].last.site), target: "_blank")
        .span4
          %p
          = @project_sponsors[1].last.mission
#large_image{:style => "background:url(#{@project.large_image}); background-size: cover"}
  .funding-info
    .container
      .span8
        %h4.title= @project.project_title
        %span.location #{@project.city}, #{@project.state}
        %span.pull-right{:style => "margin-top: -20px"}
          - if @project.partial_funding
            = image_tag 'pf-logo-black.png', class: "tax-deductible deductable-black", "data-toggle" => "tooltip", title: "Partial Funding"
        %span.pull-right{:style => "margin-top: -20px"}
          - if tax_deductible?(@project)
            = image_tag 'td-logo-black.png', class: "tax-deductible deductable-black", "data-toggle" => "tooltip", title: "Donations Are Tax Deductible"
        %hr
        %p.short-desc= @project.title
        %h6{:style => "color:#403e37;font-family:'Proxima Nova Semi';display:inline-block;margin:0;letter-spacing:normal;"} SHARE:
        %a.fb-count{:href => "https://www.facebook.com/dialog/feed?app_id=#{Settings.facebook.api_key}&link=#{project_url(@project.id)}&picture=#{@project.large_image}&name=#{url_encode(@project.project_title)}&caption=#{url_encode(@project.category)}&description=#{url_encode("Like making a difference? Check out this great project I found....")}&redirect_uri=#{root_url}", :target => "_blank"}
          %span
        .tw-count
          %span
        .bitly-link
          - if @project.bitly
            %span= @project.bitly.sub(/http:\/\//, '')
          - else
            %span

        /%p= link_to "Contact Project Creator", "mailto:#{User.find(@project.user_id).email}"

      .span4
        .progress-container.span3.offset1
          %div
            %span Funds Pledged
            %p= @project.total_funded.eql?(0) ? "$0" : amount_converter(@project.total_funded)

        #progressbar

        .project-details.cf
          %span.small
            Project
            %br
            Goal
          .amount= amount_converter(@project.goal)

          - unless @project.funding_complete?
            .days-left
              %span.small
                Days
                %br
                Left
              .amount= campaign_days_left(@project) > 0 ? campaign_days_left(@project):0

.container
  .row-fluid.show-content
    .span8

      %ul#myTab1.tab-nav
        %li.active
          %a{:href => "#planting_seeds"}
            About Us
        - unless @project.project_updates.empty?
          %li
            %a{:href => "#growth"}
              Growth
              %span (Updates)
        - unless @images.empty?
          %li
            %a{:href => "#gallery"} Gallery
      #content_container.tab-content
        #planting_seeds.tab-pane.active
          - if @project.seed_mime_type.eql?("video") and !@project.seed_video.blank?
            -if @project.seed_video.start_with?("http://www.youtube.com/")
              - video_seed = @project.seed_video.gsub("http", "https").gsub("watch?v=", "embed/")
            -else
              - video_seed = @project.seed_video.gsub("http", "https").gsub(".be", "be.com/embed")
            %iframe{:height => "413", :src => video_seed, :width => "620"}
          - elsif @project.seed_mime_type.eql?("image") and !@project.seed_image.blank?
            = image_tag "#{@project.seed_image}", style: "width:100%"
          %h4{:style => "margin-top: 20px;color: #81c263 !important;font-weight: 400;"}= @project.organization
          %div
            .fb-like{:style => "display: inline-block; float: left; margin-left: 5px;width:76px !important;", "data-href" => project_url(@project.id), "data-layout" => "button_count", "data-send" => "false", "data-show-faces" => "true", "data-width" => "76"}
            %a.twitter-follow-button{:style => "display: inline-block; float: left; margin-left: 10px;", "data-show-count" => "false", :href => "https://twitter.com/#{@project.twitter_handle}"} Follow
            %span.label-green{:style => "margin-left: 10px; font-family: 'Proxima Nova Semi', sans-serif;display:inline-block;"}
              WEB:
              = link_to(strip_url(@project.website), recognize_url(@project.website), target: "_blank", :style => "font-style: italic; text-decoration: underline; color: #3f403b; font-family: 'Georgia', serif;")
            %span{style: "margin-left: 10px;display:inline-block;"}
              = image_tag "message-green.png"
              = link_to "Contact Us", "mailto:#{User.find(@project.user_id).email}", target: "_blank", :style => "font-style: italic; text-decoration: underline; color: #3f403b; font-family: 'Georgia', serif;"
          %div{:style => "font:normal 14px/24px 'Proxima Nova', arial, sans-serif;margin-top:10px;word-wrap: pre-line;"}= simple_format(@project.story)
        - unless @project.project_updates.empty?
          #growth.tab-pane
            - @project.project_updates.each do |update|
              %div
                = update.title
                %br
                = update.content
              %hr
        - unless @images.empty?
          #gallery.tab-pane.clearfix
            .images-content
              - @images.each do |image|
                %a.thumb-link{:href => image.gallery_file_name, :rel => "prettyPhoto"}
                  = image_tag("#{image.gallery_file_name}/convert?w=190&h=120&quality=65", class: "gallery-thumb")
              .clearfix
              = paginate @images, :params => {:id => @project.id, :controller => 'projects', :action => 'show_more_image'}, remote: true

      - if !@sponsorship_benefits.blank? && @project.sponsor_permission
        %h4.title{:style => 'margin-top:50px;'}
          PROJECT SPONSORS
          - unless @project.funding_complete?
            - if @project_sponsors.include?(2) || @project_sponsors.include?(3)
              = link_to new_project_sponsor_path(@project.id), :class => 'btn', :style => 'margin-top: -10px;'  do
                Become A Sponsor ►
          %span
        .project-sponsors
          - if !@project_sponsors.include?(2) && !@project_sponsors.include?(3)
            - unless @project.funding_complete?
              = link_to new_project_sponsor_path(@project.id), :class => 'btn' do
                Become A Sponsor ►
          - if @project_sponsors.include?(2)
            .gold-level
              - if @project_sponsors.include?(2)
                %h4= "#{@project_sponsors[2].last.sponsorship_level_name} Level Sponsors"
                - @project_sponsors[2].each do |sponsor|
                  = sponsor_item(sponsor)
          - if @project_sponsors.include?(3)
            .silver-level
              - if @project_sponsors.include?(3)
                %h4= "#{@project_sponsors[3].last.sponsorship_level_name} Level Sponsors"
                - @project_sponsors[3].each do |sponsor|
                  = sponsor_item(sponsor)

      %h4.title Location
      .map-container
        #map{:style => "width:100%;height:300px"}
        #map-details
          .project-location
            %div{:style => 'font-family:"Proxima Nova"'}
              = image_tag "marker.jpg", :class => 'marker', :style => 'float:none;'
              = "#{@project.address},"
              = "#{@project.city},"
              = @project.state
              = @project.zip


      #content_container
        #cultivation
          .span3.ending
            %h4.title{style: "color: #464646 !important; font-weight: bold;"}
              Project Details

            %h6{:style => "text-align:center;color:#55554d !important;font-family:'Proxima Nova';margin-top:15px;"} Funding Ends
            %div.circlegrey{style: "background: #b6b6b4;"}
              %span{:style => 'display:block;text-align:center;font:normal 22px/22px "Proxima Nova Semi";color:#fff;text-transform:uppercase;letter-spacing:5px;'}= @project.campaign_deadline.strftime("%b")
              %span{:style => 'display:block;text-align:center;font:normal 72px/72px "Proxima Nova Semi";color:#fff;text-transform:uppercase;margin-top:5px'}= @project.campaign_deadline.strftime("%d")
            %h6{:style => "text-align:center;color:#55554d !important;font-family:'Proxima Nova';margin-top:40px;margin-bottom:0;"} Project Goal
            %h2{:style => "text-align:center;color:#403e37;font-family:'Proxima Nova Semi';margin-top:0;"}= amount_converter(@project.goal)

          .span9.details
            - if @project.cultivation_mime_type.eql?("video") and !@project.cultivation_video.blank?
              - cultivation_video = @project.cultivation_video.gsub("watch?v=", "embed/")
              %iframe{:height => "310", :src => cultivation_video, :width => "380"}
            - elsif @project.cultivation_mime_type.eql?("image") and !@project.cultivation_image.blank?
              = image_tag "#{@project.cultivation_image}", style: "float:left; width:100%"
            %div{:style => "font:normal 14px/24px 'Proxima Nova', arial, sans-serif;margin-top:10px;word-wrap: pre-line;"}= simple_format(@project.about)


    .span4.sidebar
      - if !@sponsorship_benefits.blank? && @project.sponsor_permission
        %h4 DONATE OR SPONSOR?
        .well.donor-sponsor-type
          %p.description
            %b Uruut's crowdfunding platform encourages participation from multiple audiences. Select the tab below that best fits your description:
          %h3.label-green.type-header DONATE
          %p.type-content.type-content-top You are an individual who cares about specific causes and wants to support that cause.
          %h3.label-green.type-header SPONSOR
          %p.type-content You are a business, foundation or a family that wants to firmly, visibly associate yourself with a cause or project.

        .sidebar-tab
          %ul#myTab2.tab-nav
            %li.active
              %a{:href => "#perks"} Donate
            %li
              %a{:href => "#sponsorship"} Sponsor

        .tab-content
          #perks.tab-pane.active
            -if @project.perk_permission
              -if @perks
                - @perks.each do |p|
                  .seed-level
                    %h3{style: "font-size: 20px;"}
                      = p.name
                    %h3
                      - if p.limit
                        %span.small-heading
                          = p.perks_available.to_i.zero? ? "(No Perks Remaining)" : "(#{p.perks_available} of #{p.perk_limit} Available)"
                    When you give #{amount_converter(p.amount.to_i)}, you will receive:
                    %ul.normal-font.dashed-list
                      %li
                        #{p.description}
                    %p.subtext
                      Uruut Reward Points: #{p.amount.to_i}
                    .clearfix{style: "margin-top: 20px;"}
                      .seed-num
                        / %div Seed
                        .amount
                          = amount_converter(p.amount.to_i)
                      - if (p.limit && p.perks_available.to_i.zero?) || @project.funding_complete?
                        .pull-right{style: "font-style: italic; margin-top: 22px;"}
                          Not Available
                          %span
                      - elsif p.limit && !p.perks_available.to_i.zero?
                        - unless @project.funding_complete?
                          = link_to "/donations/new?perk=#{p.id}&amount=#{p.amount.to_i}&name=#{p.name}&description=#{p.description}&project_id=#{@project.id}", class: "btn perk pull-right", style: "margin-top: 10px;" do
                            Fund Now ►
                      - else
                        - unless @project.funding_complete?
                          = link_to "/donations/new?perk=#{p.id}&amount=#{p.amount.to_i}&name=#{p.name}&description=#{p.description}&project_id=#{@project.id}", class: "btn perk pull-right", style: "margin-top: 10px;" do
                            Fund Now ►

            -else
              - default_perk.each_with_index do |perk, index|
                - index += 1
                - name = "LEVEL #{index}"
                - description = "#{perk} Uruut Reward Points"
                .seed-level
                  %h3= name
                  When you give #{amount_converter(perk.to_i)}, you will receive:
                  %ul.normal-font.dashed-list
                    %li= description
                  .clearfix
                    .seed-num
                      .amount
                        =amount_converter(perk)
                    - if @project.funding_active?
                      = link_to "/default_perk_donations?amount=#{perk}&name=#{name}&description=#{description}&project_id=#{@project.id}", :class => "btn perk pull-right", :style => "margin-top: 10px;" do
                        Fund Now ►
            - unless @project.funding_complete?
              .seed-level{id: "perk-id-custom"}
                %h3.perk-name-other{id: "perk-name-other-custom"}
                  CHOOSE YOUR PERK
                %p With this option you choose the desired amount, you will receive 1 Uruut Reward Point for each dollar you give.
                .clearfix
                  .seed-num
                    .amount
                    %h5 DESIRED AMOUNT
                    .textarea.seed-amount= text_field_tag :custom_seed, nil, style: "width: 100%"
                  %a.btn.pull-right{:class => "fund btn", "perk-id" => "custom", id: "button-seed-custom"} Fund Now ►
          #sponsorship.tab-pane
            - @sponsorship_levels.each_pair do |key, level|
              .seed-level
                %h3
                  = level.name
                  - unless level.parent.name.downcase === 'bronze'
                    %span.small-heading
                      - unless @project.funding_complete?
                        ( #{availability(@project.project_sponsors, level)} of #{SponsorshipLevel::AVAILABILITY[level.parent.name.downcase]} available)
                      - else
                        (0 of #{SponsorshipLevel::AVAILABILITY[level.parent.name.downcase]} available)
                %ul.normal-font.dashed-list
                  - if @sponsorship_benefits.include?(level.id)
                    - @sponsorship_benefits[level.id].each do |benefit|
                      %li= benefit.name
                .clearfix
                  .seed-num
                    .amount
                      = amount_converter( level.calculated_cost(@project) )
                  - if (check_availibility(@project, level.id) < SponsorshipLevel::AVAILABILITY[level.parent.name.downcase] || level.parent.name.downcase === 'bronze') && @project.funding_active?
                    %a.btn.pull-right.sponsors{:href => "/projects/#{@project.id}/sponsors/new?level=#{level.parent.name.downcase}", style: "margin-top: 10px;"}
                      Sponsor ►
                  - else
                    .pull-right{style: "margin-top: 24px; font-style: italic;"}
                      Not Available
                      %span
      - else
        %h4.tittle{style: "margin-bottom: 0;"} Donate
        -if @project.perk_permission
          -if @perks
            - @perks.each do |p|
              .seed-level
                %h3{style: "font-size: 20px;"}
                  = p.name
                %h3
                  - if p.limit
                    %span.small-heading
                      = p.perks_available.to_i.zero? ? "(No Perks Remaining)" : "(#{p.perks_available} of #{p.perk_limit} Available)"
                When you give #{amount_converter(p.amount.to_i)}, you will receive:
                %ul.normal-font.dashed-list
                  %li
                    #{p.description}
                %p.subtext
                  Uruut Reward Points: #{p.amount.to_i}
                .clearfix{style: "margin-top: 20px;"}
                  .seed-num
                    / %div Seed
                    .amount
                      = amount_converter(p.amount.to_i)
                  - if (p.limit && p.perks_available.to_i.zero?) || @project.funding_complete?
                    .pull-right{style: "font-style: italic; margin-top: 22px;"}
                      Not Available
                      %span
                  -elsif p.limit && !p.perks_available.to_i.zero? && @project.funding_active?
                    %a.btn.pull-right{:href => "/donations/new?perk=#{p.id}&amount=#{p.amount.to_i}&name=#{p.name}&description=#{p.description}&project_id=#{@project.id}", :class => "fund btn"} Fund Now ►
                  - else
                    - unless @project.funding_complete?
                      %a.btn.pull-right{:href => "/donations/new?perk=#{p.id}&amount=#{p.amount.to_i}&name=#{p.name}&description=#{p.description}&project_id=#{@project.id}"} Fund Now
        -else
          - default_perk.each_with_index do |perk, index|
            - index += 1
            - name = "LEVEL #{index}"
            - description = "#{perk} Uruut Reward Points"
            .seed-level
              %h3= name
              When you give #{amount_converter(perk.to_i)}, you will receive:
              %ul.normal-font.dashed-list
                %li= description
              .clearfix
                .seed-num
                  / %div Seed
                  .amount
                    = amount_converter(perk)
                - if @project.funding_active?
                  %a.btn.pull-right{:href => "/default_perk_donations?amount=#{perk}&name=#{name}&description=#{description}&project_id=#{@project.id}", :class => "fund btn"} Fund Now ►
        - unless @project.funding_complete?
          .seed-level{id: "perk-id-custom"}
            %h3.perk-name-other{id: "perk-name-other-custom"}
              CHOOSE YOUR PERK
            %p With this option you choose the desired amount, you will receive 1 Uruut Reward Point for each dollar you give.
            .clearfix
              .seed-num
                .amount
                %h5 DESIRED AMOUNT
                .textarea.seed-amount= text_field_tag :custom_seed, nil, style: "width: 100%"
              %a.btn.pull-right{:class => "fund btn", "perk-id" => "custom", id: "button-seed-custom"} Fund Now ►


      %h4.title{:style => 'margin-top:50px;'}
        Project Owner
      .planter
        = image_tag @project.user.avatar
        %h4= @project.organization

      - if !@sponsorship_benefits.blank? && @project.sponsor_permission
        %h4.title{:style => 'margin-top:50px;'} PROJECT SPONSORS
        - if @project_sponsors.include?(4)
          %div
            BRONZE LEVEL SPONSOR
            %div.project-sponsors-link
              / - if @project_sponsors.include?(4)
              - last_sponsor = @project_sponsors[4].last
              - @project_sponsors[4].each do |sponsor|
                - if sponsor.anonymous
                  = link_to("ANONYMOUS SPONSOR", "javascript:void(0)")
                  - unless last_sponsor == sponsor
                    ,
                - else
                  = link_to(sponsor.name, recognize_url(sponsor.site), target: "_blank")
                  - unless last_sponsor == sponsor
                    ,
        - unless @project.funding_complete?
          %div{style: "margin-top: 5px;"}
            %a.btn{:href => "/projects/#{@project.id}/sponsors/new?level=bronze"}
              Become A Sponsor ►

      %h4.title{:style => 'margin-top:50px;'}Donors(#{@project.distinct_donors.count})
      - if notice
        %div.business
          - @project.distinct_donors.each do |donation|
            - if user_signed_in?
              = link_to(image_tag(donation.user.avatar, style: "width: 27px; height:27px; margin-bottom: 5px; border-radius: 500px 500px 500px 500px; behavior: url('assets/PIE-1.0.0/PIE.htc');"), profile_path(donation.user.id))
            - else
              = link_to(image_tag(donation.user.avatar, style: "width: 27px; height:27px; margin-bottom: 5px; border-radius: 500px 500px 500px 500px; behavior: url('assets/PIE-1.0.0/PIE.htc');"), "javascript:void(0)", "url-data" => "/users/#{donation.user.id}/profile", class: "unsignin")
      - else
        %div.business
          - @project.distinct_donors.limit(20).each do |donation|
            - unless Donation.find_by_user_id(donation.user_id).anonymous
              - if user_signed_in?
                = link_to(image_tag(donation.user.avatar, style: "width: 27px; height:27px; margin-bottom: 5px; border-radius: 500px 500px 500px 500px; behavior: url('assets/PIE-1.0.0/PIE.htc');"), profile_path(donation.user.id))
              - else
                = link_to(image_tag(donation.user.avatar, style: "width: 27px; height:27px; margin-bottom: 5px; border-radius: 500px 500px 500px 500px; behavior: url('assets/PIE-1.0.0/PIE.htc');"), "javascript:void(0)", "url-data" => "/users/#{donation.user.id}/profile", class: "unsignin")
            - else
              = link_to(image_tag("anonymous.png", style: "width: 27px; height:27px; margin-bottom: 5px; border-radius: 500px 500px 500px 500px; behavior: url('assets/PIE-1.0.0/PIE.htc');", "data-toggle" => "tooltip", title: "ANONYMOUS DONOR", class: "donor-anonymous"), "javascript:void(0)")
        - if @project.distinct_donors.count > 20
          - if user_signed_in?
            = link_to project_more_donators_path(@project, logged_in: :yes), :class => 'btn more', :style => 'margin-top:10px;', remote: true do
              Show More
              %span
          - else
            = link_to "javascript:void(0)", "url-data" => project_more_donators_path(@project.id), :class => 'btn more unsignin', :style => 'margin-top:10px;' do
              Show More
              %span

= javascript_include_tag "//maps.google.com/maps/api/js?sensor=false"
= javascript_include_tag "leaflet"
= javascript_include_tag "tile.stamen"

:javascript

  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=209907642492838";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));

  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');

  $("#button-seed-custom").on("click", function(){
    $.ajax({
      url: "/default_perk_donations?amount="+ $("#custom_seed").val() +"&name=custom&project_id=#{@project.id}"
    }).done(function(data) {
      window.location.href = "/default_perk_donations?amount="+ $("#custom_seed").val() +"&name=custom&project_id=#{@project.id}"
    });
  });

  $("#button-seed-custom-unsignin").on("click", function(){
    sign_url = '#{request.protocol}' + document.location.hostname + ":" + document.location.port + "/default_perk_donations?amount="+ $("#custom_seed").val() +"&name=custom&project_id=#{@project.id}";
    url = "/default_perk_donations?amount="+ $("#custom_seed").val() +"&name=custom&project_id=#{@project.id}";
    $('.modal').remove();
      $('body').append('<div class="modal hide fade" style="text-align:center;padding:50px;"><button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="position:absolute;top:10px;right:20px;">×</button><h5 style="margin-bottom:20px;">You need to sign in or sign up before continuing.</h5><a href="'+ url +'" class="btn green-btn">Sign In ►</a> <span style="font:italic 12px/21px georgia, serif;margin:0 10px;">or</span> <a href="/projects/set_previous_path_for_registration_perk?url='+ encodeURIComponent(sign_url) +'" class="btn green-btn">Sign Up ►</a></div>');
    $('.modal').modal();
  });

  $(document).ready(function(){
    $('.donor-anonymous').tooltip();
    $("a[rel^='prettyPhoto']").prettyPhoto();

    $('.unsignin').click(function(){
      sign_url = '#{request.protocol}' + document.location.hostname + ":" + document.location.port + $(this).attr("url-data")
      url = $(this).attr("url-data");
      $('.modal').remove();
      $('body').append('<div class="modal hide fade" style="text-align:center;padding:50px;"><button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="position:absolute;top:10px;right:20px;">×</button><h5 style="margin-bottom:20px;">You need to sign in or sign up before continuing.</h5><a href="'+ url +'" class="btn green-btn">Sign In ►</a> <span style="font:italic 12px/21px georgia, serif;margin:0 10px;">or</span> <a href="/projects/set_previous_path_for_registration?url='+ sign_url +'" class="btn green-btn">Sign Up ►</a></div>');
      $('.modal').modal();
    });

    $(".unsignin-perk").click(function(){
      sign_up_url = $(this).attr("url-sign-up") + '&is_donor=' + this.getAttribute('data-is-donor');
      sign_in_url = $(this).attr("url-sign-in");
      $('.modal').remove();
      $('body').append('<div class="modal hide fade" style="text-align:center;padding:50px;"><button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="position:absolute;top:10px;right:20px;">×</button><h5 style="margin-bottom:20px;">You need to sign in or sign up before continuing.</h5><a href="'+ sign_in_url +'" class="btn green-btn">Sign In ►</a> <span style="font:italic 12px/21px georgia, serif;margin:0 10px;">or</span> <a href="/projects/set_previous_path_for_registration_perk?url='+ sign_up_url +'" class="btn green-btn">Sign Up  ►</a></div>');
      $('.modal').modal();
    });

  });

  var getFbCount = function() {
    $.ajax({
      type: "GET",
      dataType: 'jsonp',
      url: "#{request.protocol}graph.facebook.com/fql?q=select%20%20like_count%20from%20link_stat%20where%20url=%22#{root_url}projects/#{@project.id}%22"
    }).done(function(data) {
      $('.fb-count span').text(data.data[0].like_count);
    });
  }

  var getTwCount = function() {
    $.ajax({
      type: "GET",
      dataType: 'jsonp',
      url: "#{request.protocol}cdn.api.twitter.com/1/urls/count.json?url=#{root_url}projects/#{@project.id}"
    }).done(function(data) {
      $('.tw-count span').text(data.count);
    });
  }

  $(function(){
    $('#myTab1 a').click(function (e) {
      e.preventDefault();
      $(this).tab('show');
    });

    $('#myTab2 a').click(function (e) {
      e.preventDefault();
      $(this).tab('show');
    });
    getFbCount();
    getTwCount();
    var activeTab = $('.nav-tabs li.active a').attr('href');

    var geocoder = new google.maps.Geocoder();
    var geocoderRequest = { address: "#{@project.address},#{@project.city},#{@project.state}" };
    geocoder.geocode(geocoderRequest, function(results, status){
      var latitude = results[0].geometry.location.lat();
      var longitude = results[0].geometry.location.lng();

      var map = L.map('map', {
          scrollWheelZoom: false
      }).setView([latitude,longitude], 11);

      var uruutIcon = L.icon({
        iconUrl: '#{image_path("map-icon.png")}',
        iconSize:     [36, 52]
      });

      L.tileLayer("https://stamen-tiles.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png", {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>'
      }).addTo(map);

      L.marker([latitude,longitude], {icon:uruutIcon}).addTo(map);
    });

    $('.tax-deductible').tooltip({
      placement: "top",
      trigger: "hover"
    });

    $(activeTab).show();

    $( "#progressbar" ).progressbar({
      value: #{@project.percent_to_goal}
    });


    var margin;
    if(#{@project.percent_to_goal} > 50) {
      margin = 50;
    }else{
      margin = #{@project.percent_to_goal};
    }

    $('#progressbar > div').css({ 'background': '#3f403b' });

    $('.nav-tabs li a').click(function(e){
      e.preventDefault();
      var show = $(this).attr('href');

      $('.nav-tabs li').removeClass('active');
      $('.nav-tabs li').each(function(){
        var content = $(this).find('a').attr('href');
        $(content).hide();
      });

      $(this).parent('li').addClass('active');
      $(show).show();
    });

    $('.tw-count').click(function(e) {
      e.preventDefault();
      var width  = 575,
          height = 400,
          left   = ($(window).width()  - width)  / 2,
          top    = ($(window).height() - height) / 2,
          url    = "#{request.protocol}twitter.com/share?url=#{project_url(@project.id)}&text=Like%20making%20a%20difference?%20Check%20out%20this%20great%20project%20I%20found....%20&hashtags=Uruut",
          opts   = 'status=1' +
                   ',width='  + width  +
                   ',height=' + height +
                   ',top='    + top    +
                   ',left='   + left;

      window.open(url, 'twitter', opts);
    })

  });
