#large_image{:style => "background:url(#{@project.large_image}/convert?w=1600&h=546&fit=crop&align=center); background-size: cover"}
  .funding-info
    .container
      .span8
        %h4.title= @project.project_title
        %span.location #{@project.city}, #{@project.state}
        %hr
        %p.short-desc= @project.title
        %h6{:style => "color:#403e37;font-family:'Proxima Nova Semi';display:inline-block;margin:0;letter-spacing:normal;"} SHARE:
        / = image_tag "fb-count.png", :class => "fb-share", :style => "margin-right:20px;"
        / = image_tag "tw-count.png", :class => "tw-share", :style => "margin-right:20px;"
        / = image_tag "bitly-link.png", :style => "margin-right:20px;"
        .fb-count
          %span
        .tw-count
          %span
        .bitly-link
          - if @project.bitly
            %span= @project.bitly.sub(/http:\/\//, '')

        %p= link_to "Contact Project Creator", "mailto:#{User.find(@project.user_id).email}"

      .span4
        .progress-container.span2.offset1
          = image_tag 'seed.png', :class => "seed"
          %div
            %span Seed Funds Pledged
            - if @donation && @donation.length == 0
              %p $0
            - else
              - totalDonated = 0
              - if @donation
                - @donation.each do |d|
                  - totalDonated += d.amount
              %p= number_to_currency(totalDonated, :precision => 0)

        #progressbar

        .project-details.cf
          %span.small
            Project
            %br
            Goal
          .amount= number_to_currency(@project.goal, :precision => 0)

          .days-left
            %span.small
              Days
              %br
              Left
            .amount= @project.duration

.container
  .row-fluid.show-content
    .span8
      %h4.title Where We're Ruuted
      .map-container
        #map{:style => "width:100%;height:300px"}
        #map-details
          .project-location
            %h4= @project.title
            %div{:style => 'font-family:"Proxima Nova"'}
              = image_tag "marker.jpg", :class => 'marker', :style => 'float:none;'
              = @project.address
              = @project.city
              = @project.state
              = @project.zip
            %div
              %h6
                WEB:
                = link_to @project.website do
                  %span{:style => "color:#403e37;font:italic 12px/12px georgia, serif;text-transform:none;letter-spacing:normal;text-decoration:underline;", :target => "_blank"}= @project.website

      %h4.title{:style => 'margin-top:50px;'} PROJECT SPONSORS
      = link_to new_project_sponsor_path(@project.id), :class => 'btn', :style => 'margin-top:10px;'  do
        Become A Sponsor
        %span

      %h4.title{:style => 'margin-top:50px;'}
        Planting Seeds
        %span (About)

      #content_container
        #planting_seeds
          - if @project.seed_image
            = image_tag "#{@project.seed_image}"
          - if @project.seed_video
            - video_seed = @project.seed_video.gsub("watch?v=", "embed/")
            %iframe{:height => "413", :src => video_seed, :width => "620"}
          %div{:style => "font:normal 14px/24px 'Proxima Nova', arial, sans-serif;margin-top:10px;word-wrap: break-word;"}= @project.about

        %hr

        #cultivation
          .span3.ending
            %h4.title
              CULTIVATION
              %br
              %span (Project Details)

              %h6{:style => "text-align:center;color:#55554d !important;font-family:'Proxima Nova';margin-top:15px;"} Funding Ends
              %div{:style => "background:#b6b6b4;padding:25px;border-radius:500px;"}
                %span{:style => 'display:block;text-align:center;font:normal 22px/22px "Proxima Nova Semi";color:#fff;text-transform:uppercase;letter-spacing:5px;'}= (Date.today + (@project.duration).to_i.days).strftime("%b")
                %span{:style => 'display:block;text-align:center;font:normal 72px/72px "Proxima Nova Semi";color:#fff;text-transform:uppercase;margin-top:5px'}= (Date.today + (@project.duration).to_i.days).strftime("%d")
              %h6{:style => "text-align:center;color:#55554d !important;font-family:'Proxima Nova';margin-top:40px;margin-bottom:0;"} Project Goal
              %h2{:style => "text-align:center;color:#b6b6b4;font-family:'Proxima Nova Semi';margin-top:0;"}= number_to_currency(@project.goal, :precision => 0)

          .span9.details
            - if @project.cultivation_image
              = image_tag "#{@project.cultivation_image}"
            - if @project.cultivation_video
              - cultivation_video = @project.cultivation_video.gsub("watch?v=", "embed/")
              %iframe{:height => "310", :src => cultivation_video, :width => "380"}
            %div{:style => "font:normal 14px/24px 'Proxima Nova', arial, sans-serif;margin-top:10px;word-wrap: break-word;"}= @project.story

      -#%hr
      -#.comments
        -#%h4.comment Post a message
        -#%p
          -#Tell #{@project.title} you support their campaign! Got questions or need more information? Post them here and get an answer!

      -#.fb-comments{'data-href' => "http://127.0.0.1:8080", :style => "width:100%"}


    .span4.sidebar
      %h4 BECOME A SPONSOR
      .well
        %h3{:style => "font-size:20px;letter-spacing:normal;color:#70bf4c;line-height:100%;margin:0;font-family:'Proxima Nova';"} PROJECT SPONSORSHIP
        %p{:style => "font:normal 12px/18px 'Proxima Nova', arial, sans-serif;color:#403e37;margin-bottom:40px;"} We can’t do this alone. Do your part, by becoming a project sponsor. URUUT Partner-Funding depends on individual contributors as well as project sponsorship from businesses and corporate and family foundations. Click the button below to get more details and become a project sponsor.
        = link_to new_project_sponsor_path(@project.id), :class => 'btn', :style => 'margin-top:10px;' do
          Become A Sponsor
          %span

      %h4.title{:style => 'margin-top:50px;'} Seeder Perks
      %ul.perks
        -if @perks
          - @perks.each do |p|
            %li.perk
              %h3= p.name
              %p.description= p.description
              %ul
                %li
                  %h6 SEED
                  %p.amount $#{p.amount.to_i}
                %li.fund-button
                  %a{:href => "/donations/new?perk=#{p.id}&amount=#{p.amount.to_i}&name=#{p.name}&description=#{p.description}", :class => "fund btn"} Fund Now #{image_tag('arrow.png')}

      %h4.title{:style => 'margin-top:50px;'}
        Planter
        %span (Project Organizer)
      .planter
        = image_tag @user.avatar, :style => "display:inline-block;margin-right:20px;width:100px;height:100px;"
        %h4{:style => "display:inline-block;color:#70bf4c;letter-spacing:2px;"}= @project.title

      %h4.title{:style => 'margin-top:50px;'} Business Partners
      = link_to new_project_sponsor_path(@project.id), :class => 'btn', :style => 'margin-top:10px;' do
        Become A Sponsor
        %span

      %h4.title{:style => 'margin-top:50px;'}
        Seeders (0)
        %span (Project Funders)


%script{:src => "http://cdn.leafletjs.com/leaflet-0.4/leaflet.js"}
%script{:src => "http://maps.stamen.com/js/tile.stamen.js?v1.2.1"}

:javascript

  var getFbCount = function() {
    $.ajax({
      type: "GET",
      dataType: 'jsonp',
      url: "http://graph.facebook.com/fql?q=select%20%20like_count%20from%20link_stat%20where%20url=%22#{root_url}projects/#{@project.id}%22"
    }).done(function(data) {
      console.log(data.data[0].like_count);
      $('.fb-count span').text(data.data[0].like_count);
    });
  }

  var getTwCount = function() {
    $.ajax({
      type: "GET",
      dataType: 'jsonp',
      url: "http://urls.api.twitter.com/1/urls/count.json?url=#{root_url}projects/#{@project.id}"
    }).done(function(data) {
      console.log(data.count);
      $('.tw-count span').text(data.count);
    });
  }

  $(function(){
    getFbCount();
    getTwCount();
    var activeTab = $('.nav-tabs li.active a').attr('href');
    var userLocation = 'http://maps.googleapis.com/maps/api/geocode/json?address=#{@project.address},#{@project.city},#{@project.state}&sensor=false';

    $(activeTab).show();

    $.ajax({
      url: userLocation,
      success: function(data) {
        console.log(data.results[0].geometry.location.lat);
        var latitude = data.results[0].geometry.location.lat;
        var longitude = data.results[0].geometry.location.lng;
        var map = L.map('map', {
          scrollWheelZoom: false
        }).setView([latitude,longitude], 11);

        var uruutIcon = L.icon({
          iconUrl: '#{image_path("map-icon.png")}',
          iconSize:     [36, 52]
        });

        L.tileLayer('http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png', {
          attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>'
        }).addTo(map);

        L.marker([latitude,longitude], {icon:uruutIcon}).addTo(map)
      }
    });


    $( "#progressbar" ).progressbar({
      value: #{percent_funded(@project.id)}
    });

    $('.nav-tabs li a').click(function(e){
      e.preventDefault();
      var show = $(this).attr('href');

      $('.nav-tabs li').removeClass('active');
      $('.nav-tabs li').each(function(){
        var content = $(this).find('a').attr('href');
        console.log(content);
        $(content).hide();
      });

      $(this).parent('li').addClass('active');
      $(show).show();
    });

    $('.fb-count').click(function() {
      console.log("#{root_url}projects/#{@project.id}")
      var publish = {
        method: 'feed',
        message: 'getting educated about Facebook Connect',
        name: "#{@project.project_title}",
        description: "#{@project.title}",
        caption: "#{@project.organization}",
        link: "#{root_url}projects/#{@project.id}",
        picture: "#{@project.large_image}",
        actions: [
          {
            name: "#{@project.project_title}",
            link: "#{root_url}projects/#{@project.id}"
          }
        ],
        user_message_prompt: 'Share your thoughts about RELL'
      };

      function callback(response) {
        if (response && response.post_id) {
          console.log('Post was published.');
        } else {
          console.log('Post was not published.');
        }
      }

      FB.ui(publish, callback);
    });

    $('.tw-count').click(function(e) {
      e.preventDefault();
      var width  = 575,
          height = 400,
          left   = ($(window).width()  - width)  / 2,
          top    = ($(window).height() - height) / 2,
          url    = "http://twitter.com/share?text=I%20just%20donated%20to%20#{@project.project_title}%2E%20Check%20it%20out%2E",
          opts   = 'status=1' +
                   ',width='  + width  +
                   ',height=' + height +
                   ',top='    + top    +
                   ',left='   + left;

      window.open(url, 'twitter', opts);
    })

  });
